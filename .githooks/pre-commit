#!/bin/sh
# Pre-commit hook to prevent emoji usage

# Colors for output
RED='\033[0;31m'
YELLOW='\033[1;33m'
GREEN='\033[0;32m'
NC='\033[0m' # No Color

echo "${YELLOW}ğŸ” Checking for emoji usage...${NC}"

# Check for common decorative emojis in staged files (excluding mathematical symbols)
EMOJI_PATTERN="[ğŸ’ªğŸ“ŠğŸ‹ğŸ“…ğŸ‘¥ğŸ“ˆğŸ¯ğŸ”¥ğŸ†â•âœ“âš™ğŸ‰â±âš–ğŸ”ğŸšªğŸƒğŸ’¼âš¡ğŸ’¯ğŸ“±ğŸ“ğŸğŸˆğŸ”„]"

# Get list of staged files (only .js, .jsx, .ts, .tsx files)
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(js|jsx|ts|tsx)$')

if [ -z "$STAGED_FILES" ]; then
    echo "${GREEN}âœ… No JavaScript/TypeScript files to check${NC}"
    exit 0
fi

# Check each staged file for emojis
EMOJI_FOUND=false
for FILE in $STAGED_FILES; do
    if [ -f "$FILE" ]; then
        # Check for emoji patterns
        EMOJI_LINES=$(grep -n "$EMOJI_PATTERN" "$FILE" 2>/dev/null || true)
        if [ ! -z "$EMOJI_LINES" ]; then
            if [ "$EMOJI_FOUND" = false ]; then
                echo "${RED}âŒ COMMIT REJECTED: Emoji usage detected!${NC}"
                echo ""
                echo "${YELLOW}Found emojis in the following files:${NC}"
                EMOJI_FOUND=true
            fi
            echo "${RED}  ğŸ“ $FILE:${NC}"
            echo "$EMOJI_LINES" | while read -r line; do
                echo "    $line"
            done
            echo ""
        fi
    fi
done

if [ "$EMOJI_FOUND" = true ]; then
    echo "${YELLOW}Please replace emojis with Lucide React icons:${NC}"
    echo "  â€¢ Import icons: ${GREEN}import { Dumbbell, BarChart3, Users } from 'lucide-react'${NC}"
    echo "  â€¢ Use JSX: ${GREEN}<Dumbbell className=\"w-5 h-5\" />${NC}"
    echo ""
    echo "${YELLOW}Common replacements:${NC}"
    echo "  ğŸ’ª â†’ <Dumbbell />"
    echo "  ğŸ“Š â†’ <BarChart3 />"
    echo "  ğŸ‘¥ â†’ <Users />"
    echo "  ğŸ“… â†’ <Calendar />"
    echo "  ğŸ“ˆ â†’ <TrendingUp />"
    echo "  ğŸ† â†’ <Trophy />"
    echo "  ğŸ”¥ â†’ <Flame />"
    echo "  âœ“ â†’ <Check />"
    echo "  Ã— â†’ <X />"
    echo "  â• â†’ <Plus />"
    echo ""
    exit 1
fi

echo "${GREEN}âœ… No emojis found - commit approved!${NC}"
exit 0